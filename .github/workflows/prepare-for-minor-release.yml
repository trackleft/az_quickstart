name: Prepare repository for new minor release
run-name: Prepare az_quickstart for the `${{ inputs.short_release_name }}` release.
on:
  workflow_dispatch:
    inputs:
      short_release_name:
        description: 'A short name for the release (e.g. 1.0.0)'
        required: true
      packagist_release_name:
        description: 'A name for the release that can be used on Packagist (e.g. 1.0.0-dev)'
        required: true
jobs:
  print_inputs:
    runs-on: ubuntu-latest
    steps:
      - name: Print inputs
        run: |
          echo "short_release_name: ${{ inputs.short_release_name }}"
          echo "packagist_release_name: ${{ inputs.packagist_release_name }}"
  draft-new-release:
    name: "Draft a new release"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Create release branch
        run: git checkout -b ${{ inputs.short_release_name }}

  update_previous_release_branches:
    strategy:
      runs-on: ubuntu-latest
      matrix:
        previous_version: [2.0, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7]
    steps:
      - uses: actions/checkout@v3
        with:
          ref: ${{ matrix.previous_version }}
      - uses: php-actions/composer@v6
        with:
          args: config extra.branch-alias.dev-main ${{ inputs.packagist_release_name }}
